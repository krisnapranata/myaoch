{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
/* ==============================
   GENERAL STYLE
============================== */
.equipment-card {
    max-width: 900px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
}

.header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 18px;
}

/* RESPONSIVE TOGGLE */
.desktop-only { display: block; }
.mobile-only { display: none; }

@media (max-width: 768px) {
    .desktop-only { display: none; }
    .mobile-only { display: block; }
}

/* ==============================
   ADD BUTTON ‚Äì Compact Blue
============================== */
.btn-add {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, #60a5fa, #3b82f6);
    color: #fff;
    text-decoration: none;
    padding: 6px 12px;          /* ‚¨ÖÔ∏è lebih kecil */
    border-radius: 8px;         /* ‚¨ÖÔ∏è sedikit lebih tajam */
    font-weight: 600;
    font-size: 0.8rem;          /* ‚¨ÖÔ∏è kecil tapi masih terbaca jelas */
    letter-spacing: 0.2px;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.25);
    transition: all 0.2s ease;
    line-height: 1.1;
}

.btn-add:hover {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    transform: translateY(-1.5px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.35);
}

.btn-add:active {
    transform: scale(0.97);
}

.btn-add i {
    background: rgba(255, 255, 255, 0.2);
    padding: 4px;               /* ‚¨ÖÔ∏è kecil */
    border-radius: 50%;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-size: 0.8rem;
}

/* ==============================
   ADD FORM STYLE (Dropdown)
============================== */
.add-form-wrapper {
    display: none;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 20px;
    animation: fadeIn 0.3s ease;
    width: 100%;              /* ‚úÖ pastikan penuh dalam card */
    box-sizing: border-box;   /* ‚úÖ biar padding & border masuk hitungan width */
    overflow: hidden;         /* ‚úÖ cegah elemen keluar */
}

.add-form-wrapper.active {
    display: block;
}

.add-form-wrapper label {
    font-weight: 600;
    font-size: 0.85rem;
    color: #334155;
    display: block;
    margin-bottom: 4px;
}

.add-form-wrapper .form-control {
    width: 100%;               /* ‚úÖ biar full dalam card */
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #cbd5e1;
    margin-bottom: 10px;
    font-size: 0.85rem;
    box-sizing: border-box;    /* ‚úÖ fix untuk mobile overflow */
}

/* ‚úÖ Pastikan form mengikuti lebar parent di mobile */
@media (max-width: 480px) {
    .add-form-wrapper {
        padding: 12px;
        border-radius: 8px;
    }

    .add-form-wrapper .form-control {
        font-size: 0.8rem;
        padding: 6px 8px;
    }

    .form-actions {
        flex-direction: column;
        align-items: stretch;
    }

    .form-actions button {
        width: 100%;            /* tombol full di mobile */
    }
}

/* Buttons */
.form-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.btn-save {
    background: #3b82f6;
    color: white;
    border: none;
    padding: 6px 14px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
}

.btn-save:hover { background: #2563eb; }

.btn-cancel {
    background: #e2e8f0;
    color: #475569;
    border: none;
    padding: 6px 14px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
}

.btn-cancel:hover { background: #cbd5e1; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ==============================
   MOBILE VERSION
============================== */
@media (max-width: 480px) {
    .btn-add {
        padding: 5px 10px;
        font-size: 0.75rem;
        border-radius: 6px;
        gap: 4px;
    }
    .btn-add i {
        padding: 3px;
        font-size: 0.75rem;
    }
}

/* ==============================
   TABLES
============================== */
.elegant-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
}

.elegant-table thead th {
    background: #f1f3f5;
    padding: 10px;
    border-radius: 8px;
    font-size: .85rem;
}

.elegant-table tbody tr {
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.elegant-table td {
    padding: 10px;
}

.act-btn {
    padding: 4px 8px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 1rem;
}

.act-btn.edit { background: #0d6efd; color: white; }
.act-btn.delete { background: #dc3545; color: white; }

.mobile-table-wrapper {
    overflow-x: auto;
    padding-bottom: 4px;
}

.mobile-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}

.mobile-table th {
    background: #e7eaef;
    padding: 6px;
    text-align: center;
    font-size: 12px;
}

.mobile-table td {
    padding: 6px;
    text-align: center;
    border-bottom: 1px solid #eee;
}

.mobile-table .act-btn {
    padding: 3px 5px;
    font-size: 12px;
    border-radius: 5px;
}

/* ==============================
   HEADER TITLE RESPONSIVE
============================== */
.header-row h4 {
    font-size: 1.1rem;    /* default desktop */
    color: #1e293b;
    margin: 0;
}

@media (max-width: 768px) {
    .header-row h4 {
        font-size: 0.95rem;   /* tablet */
    }
}

@media (max-width: 480px) {
    .header-row h4 {
        font-size: 0.8rem;    /* üì± hp kecil: lebih kecil & rapi */
    }
}

/* ==============================
   MESSAGES STYLE ‚Äì Clean Responsive
============================== */
.messages {
    margin-bottom: 14px;
    animation: fadeInMsg 0.4s ease;
}

.msg {
    padding: 8px 12px;
    border-radius: 8px;
    margin-bottom: 6px;
    font-size: 0.85rem;        /* ‚¨ÖÔ∏è lebih kecil dari sebelumnya */
    font-weight: 500;
    line-height: 1.3;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.msg.success {
    background: #e0f2fe;       /* biru muda lembut */
    color: #075985;            /* biru tua */
    border: 1px solid #bae6fd;
}

.msg.error {
    background: #fee2e2;       /* merah pastel */
    color: #991b1b;
    border: 1px solid #fecaca;
}

.msg.warning {
    background: #fef9c3;
    color: #854d0e;
    border: 1px solid #fde68a;
}

/* üîπ RESPONSIVE untuk HP */
@media (max-width: 480px) {
    .msg {
        font-size: 0.75rem;    /* ‚¨ÖÔ∏è lebih kecil di HP */
        padding: 6px 10px;
        border-radius: 6px;
        margin-bottom: 4px;
    }
}

/* Animasi lembut */
@keyframes fadeInMsg {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ==============================
   TOOLBAR SEARCH STYLE
============================== */
.toolbar-row {
    margin-bottom: 12px;
    display: flex;
    justify-content: flex-end;
}

.toolbar-search {
    width: 240px;
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    background-color: #f8fafc;
    font-size: 0.85rem;
    color: #334155;
    transition: all 0.2s ease;
}

.toolbar-search:focus {
    outline: none;
    border-color: #60a5fa;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25);
    background-color: #fff;
}

/* Responsif untuk HP */
@media (max-width: 480px) {
    .toolbar-row {
        justify-content: center;
    }

    .toolbar-search {
        width: 100%;
        font-size: 0.8rem;
        padding: 6px 8px;
    }
}

</style>

{% if messages %}
<div class="messages">
    {% for message in messages %}
          {% if 'peralatan' in message.tags %}
                <div class="msg success">{{ message }}</div>
            {% endif %}
    {% endfor %}
</div>
{% endif %}

<!-- di template sementara -->

<h1 class="page-title">üì¶ Daftar Peralatan</h1>

<div class="equipment-card">
    <div class="header-row">
        <h4 class="fw-bold">List Peralatan Unit {{ request.appuser.unit.nama_unit }}</h4>
        <!-- üíé Compact Blue Button -->
        <button id="toggleFormBtn" class="btn-add" type="button">
            <i>‚ûï</i> Tambah
        </button>
    </div>
    <!-- üîΩ Form Tambah Peralatan (Hidden by default) -->
    <div id="addFormWrapper" class="add-form-wrapper">
        <form method="POST" action="{% url 'peralatan_add' %}">
            {% csrf_token %}

            <div class="form-group">
                <label>Kode Peralatan</label>
                <input type="text" name="kode_peralatan" class="form-control"
                    value="{{ form.kode_peralatan }}" readonly>
            </div>

            <div class="form-group">
                <label>Nama Peralatan</label>
                <input type="text" name="nama_peralatan" class="form-control" required>
            </div>

            <div class="form-group">
                <label>Jumlah</label>
                <input type="number" name="jumlah_alat" class="form-control" min="1" value="1" required>
            </div>

            <div class="form-group">
                <label>Merek</label>
                <input type="text" name="merk" class="form-control">
            </div>

            <div class="form-group">
                <label>Model</label>
                <input type="text" name="model" class="form-control">
            </div>

            <div class="form-group">
                <label>Tahun Pengadaan</label>
                <input type="number" name="tahun_pengadaan" class="form-control" min="1900" max="2100">
            </div>

            <div class="form-group">
                <label>Keterangan</label>
                <textarea name="keterangan" class="form-control" rows="2"></textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-save">üíæ Simpan</button>
                <button type="button" class="btn-cancel" id="cancelFormBtn">‚úñ Batal</button>
            </div>
        </form>
    </div>

    <div class="toolbar-row">
        <input type="text" id="searchInput" class="toolbar-search"
            placeholder="üîç Cari peralatan...">
    </div>


    <!-- Desktop Table -->
    <div class="desktop-only">
        <table class="elegant-table">
            <thead>
                <tr>
                    <th>Kode</th>
                    <th>Nama Peralatan</th>
                    <th class="center">Jumlah</th>
                    <th class="center">Merek</th>
                    <th class="center">Model</th>
                    <th class="center">Tahun Pengadaan</th>
                    <th class="center">Keterangan</th>
                    <th class="center">Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for p in peralatan %}
                <tr>
                    <td>{{ p.kode_peralatan }}</td>
                    <td>{{ p.nama_peralatan }}</td>
                    <td>{{ p.jumlah_alat }}</td>
                    <td>{{ p.merk }}</td>
                    <td class="center">{{ p.model }}</td>
                    <td class="center">{{ p.tahun_pengadaan }}</td>
                    <td class="center">{{ p.keterangan }}</td>
                    <td class="center">
                        <!--<a href="{% url 'peralatan_edit' p.id %}" class="act-btn edit">‚úèÔ∏è</a>-->
                        <a href="#" class="act-btn edit" data-id="{{ p.id }}">‚úèÔ∏è</a>
                        <a href="{% url 'peralatan_delete' p.id %}" class="act-btn delete"
                           onclick="return confirm('Hapus peralatan ini?')">üóëÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Mobile Table -->
    <div class="mobile-only mobile-table-wrapper">
        <table class="mobile-table">
            <thead>
                <tr>
                    <th>Kode</th>
                    <th>Nama</th>
                    <th>Jumlah</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for p in peralatan %}
                <tr>
                    <td>{{ p.kode_peralatan }}</td>
                    <td style="text-align:left;">{{ p.nama_peralatan }}</td>
                    <td>{{ p.jumlah_alat }}</td>
                    <td>
                        <!--<a href="{% url 'peralatan_edit' p.id %}" class="act-btn edit">‚úèÔ∏è</a>-->
                        <a href="#" class="act-btn edit" data-id="{{ p.id }}">‚úèÔ∏è</a>
                        <a href="{% url 'peralatan_delete' p.id %}" class="act-btn delete"
                           onclick="return confirm('Hapus peralatan ini?')">üóëÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- üîπ Auto-hide messages -->
<script>
setTimeout(() => {
    document.querySelectorAll('.msg').forEach(el => el.style.display = 'none');
}, 3000);
</script>

<!-- üîπ ADD & EDIT form logic -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const formWrapper = document.getElementById('addFormWrapper');
    const toggleBtn = document.getElementById('toggleFormBtn');
    const cancelBtn = document.getElementById('cancelFormBtn');
    const form = formWrapper.querySelector('form');

    // ‚úÖ Tambah data
    toggleBtn.addEventListener('click', () => {
        form.reset();
        form.action = "{% url 'peralatan_add' %}";
        formWrapper.classList.toggle('active');

        fetch("{% url 'ajax_generate_kode' %}")
            .then(res => res.json())
            .then(data => {
                form.querySelector("input[name='kode_peralatan']").value = data.kode;
            });
    });

    // ‚úÖ Edit data
    document.querySelectorAll('.act-btn.edit').forEach(btn => {
        btn.addEventListener('click', e => {
            e.preventDefault();
            const id = btn.dataset.id;

            fetch(`/peralatan/${id}/json/`)
                .then(res => res.json())
                .then(data => {
                    formWrapper.classList.add('active');
                    form.action = `/peralatan/${id}/edit/`;

                    form.querySelector("input[name='kode_peralatan']").value = data.kode_peralatan;
                    form.querySelector("input[name='nama_peralatan']").value = data.nama_peralatan;
                    form.querySelector("input[name='jumlah_alat']").value = data.jumlah_alat;
                    form.querySelector("input[name='merk']").value = data.merk;
                    form.querySelector("input[name='model']").value = data.model;
                    form.querySelector("input[name='tahun_pengadaan']").value = data.tahun_pengadaan;
                    form.querySelector("textarea[name='keterangan']").value = data.keterangan;
                });
        });
    });

    // ‚úÖ Batal
    cancelBtn.addEventListener('click', () => {
        formWrapper.classList.remove('active');
        form.reset();
    });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const tableRows = document.querySelectorAll('.elegant-table tbody tr, .mobile-table tbody tr');

    searchInput.addEventListener('input', function() {
        const keyword = this.value.toLowerCase();

        tableRows.forEach(row => {
            const text = row.textContent.toLowerCase();
            if (text.includes(keyword)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
});
</script>


{% endblock %}
